"use strict";define("fonts/utils/fontUtils",["lodash","utils","coreUtilsLib"],function(t,e,n){function o(t,e){k[t]=e}function r(t,e){M[t]=e}function a(t){return e.cssUtils.parseFontStr(t)}function s(e){return t.compact(t.map(e,function(t){return T.getFontsMetaData()[t]}))}function i(e){return t(e).split(",").invokeMap("replace",/.*[^\w\d\-].*/,'"$&"').join(",")}function l(t){var e,n=T.getFontsMetaData()[t.toLowerCase()],o=n.fontFamily;return n?(e=o,""!==n.fallbacks&&(e+=","+n.fallbacks),e+=","+n.genericFamily):e=t,i(e)}function u(e,n){if(0!==e.length){var o=t.map(e,function(t){return t.cdnName+":n,b,i,bi|"});return n&&(o.push("&subset="),o.push(n.join(","))),"//fonts.googleapis.com/css?family="+o.join("")}}function f(e,n){return s(t.filter(c(e,n),function(e){return t.has(T.getFontsMetaData(),e)}))}function c(t,e){return F(t,e)}function g(e){return d(e,t.times(11,function(t){return"font_"+t}))}function F(n,o){var r=n.getPageData(o).data.document_data,a=t(r).filter(function(e){return t.has(k,e.type)}).map(function(o){var r=k[o.type](n,o);return t.union(e.fonts.fontsParser.collectFontsFromTextDataArray(r))}).flattenDeep().value(),s=t(r).filter(function(e){return t.has(M,e.type)}).map(function(t){return M[t.type](n,t)||[]}).flattenDeep().value(),i=t.get(r,"masterPage.usedFonts",[]);return t.union(a,s,g(n),i)}function d(e,n){var o=e.getGeneralTheme();return t.map(n,function(t){return m(o,t)})}function m(t,e){var n=t.font,o=parseInt(e.substring(e.indexOf("_")+1),10),r=n[o],s="";return r&&(s=a(r).family.toLowerCase()),s}function p(e,n){var o=x(e,n);return t.values(o)}function v(e,n){var o=y(e);return t(W).intersection(n).map(function(t){return{lang:t,fonts:o[t]}}).value()}function y(e){var n=S(e),o=t.reduce(T.getFontsMetaData(),function(e,o,r){var a=o.characterSets;return t.includes(n,o.permissions)&&(o.cssFontFamily=l(r),t.forEach(a,function(t){e[t]||(e[t]=[]),e[t].push(o)})),e},{});return t.forOwn(o,function(e,n){o[n]=t.sortBy(e,"displayName")}),o}function h(e,n,o){var r=t.isArray(e)?e:t.keys(e),a=U(r,n,o);return a?"//fonts.googleapis.com/css?family="+a:""}function S(t){var e=["all","legacy"];return"WixSite"===t&&e.push("studio"),e}function U(e,n,o){var r="",a=S(n);return t.forEach(e,function(e){var n=T.getFontsMetaData()[e];n&&n.cdnName&&t.includes(a,n.permissions)&&(r+=n.cdnName,r+=":n,b,i,bi|")}),""===r?null:(o&&(r+="&subset="+o.join(",")),r)}function C(t){D.lastIndex=0;var e=D.exec(t);return e?e[1]:void 0}function b(t){return t.publicStaticsUrl+"/css/Helvetica/fontFace.css"}function x(t,n){var o={langauges:e.media.getMediaUrl(t,"user-site-fonts/v3/languages.css")};return"WixSite"===n&&(o.helveticas=e.media.getMediaUrl(t,"user-site-fonts/v3/helvetica.css")),o}function P(e,n){var o={};return o.googleFonts=h(T.getFontsMetaData(),e,W),t.merge(o,x(n,e)),o}var T=n.fonts,W=["latin-ext","cyrillic","japanese","korean","arabic","hebrew","latin"],D=/<[^>]+class="[^"]*(font_[0-9]+)[^"]*"/g,k={StyledText:function(t,e){return[e.text]},RichText:function(t,e){return[e.text]}},M={};return e.sessionFreezer.freeze(M),{parseFontStr:T.parseFontStr,parseStyleFont:T.parseStyleFont,getMetadata:s,getGoogleFontsUrl:u,getFontFamily:T.getFontFamily,getFontFallback:T.getFontFallback,getPageFontsMetaData:f,getFontFamilyWithFallbacks:T.getFontFamilyWithFallbacks,getWixStoredFontsCssUrls:p,getWixStoredFontsCssUrlsWithParams:T.getWixStoredFontsCssUrlsWithParams,getCurrentSelectablefontsWithParams:v,collectFontsFromTextDataArray:e.fonts.fontsParser.collectFontsFromTextDataArray,getFontsUrlWithParams:T.getFontsUrlWithParams,getFontFamilyByStyleId:m,getFontClassName:C,registerCustomTextDataGetter:o,registerCustomFontFamiliesGetter:r,getPageUsedFontsList:c,getWixHelveticaUrl:b,getCssUrls:P,fontToCSSWithColor:T.fontToCSSWithColor,getFontFamilyPermissions:T.getFontFamilyPermissions,POSSIBLE_CHARACTERS_SETS:W}}),define("fonts/utils/fontCss",["lodash","fonts/utils/fontUtils"],function(t,e){function n(t){var n=t,o=e.getFontFallback(t);return o&&(n=n+","+o),n=n.replace(/[^,]*[^\w,\d\-][^,]*/g,function(t){return"'"+t.replace(/\+/g," ")+"'"})}function o(o){var r=o;t.includes(r,"#")&&(r=r.slice(0,r.indexOf("#"))),r=r.replace(/\{color_\d+\}/,"");var a=e.getFontFamily(r),s=n(a);return r.replace(a,s)+";"}function r(e,n){if(t.startsWith(e,"font_")){var o=e.split("font_");if(2===o.length)return n.font[o[1]]}return e}function a(t,e){return o(r(t,e))}function s(n,o){var r="";return t.forEach(n,function(t,n){r+=".font_"+n+" {font: "+e.fontToCSSWithColor(t,o)+"} \n"}),r}return{fontToCSSWithoutColor:a,getThemeFontsCss:s,getFullFontFamily:n}}),define("fonts/utils/fontsTracker",["lodash","fonts/utils/fontUtils"],function(t,e){function n(n,s){if(!t.isObject(n))return!1;a.masterPage=a.masterPage||o(n,"masterPage"),a[s]=a[s]||o(n,s);var i=t.union(a.masterPage,a[s]),l=e.getMetadata(i);return t.some(l,{permissions:r.permissions,provider:r.provider})}function o(t,n){return e.getPageUsedFontsList(t,n)}var r={permissions:"all",provider:"monotype"},a=Object.create(null);return{shouldTrackFonts:n}}),define("fonts",["fonts/utils/fontUtils","fonts/utils/fontCss","fonts/utils/fontsTracker","coreUtilsLib"],function(t,e,n,o){return{fontUtils:t,fontCss:e,fontMetadata:o.fonts.getFontsMetaData(),uplodedFontsUtils:{isUploadedFontFamily:o.fonts.isUploadedFontFamily,getUploadedId:o.fonts.getUploadedId,getUploadedFontFaceStyles:o.fonts.getUploadedFontFaceStyles,getUploadedFontValue:o.fonts.getUploadedFontValue},fontsTracker:n}});
//# sourceMappingURL=fonts.min.js.map