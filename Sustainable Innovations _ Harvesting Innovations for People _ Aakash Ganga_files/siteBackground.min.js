"use strict";define("siteBackground",["lodash","santaProps","core","utils","mediaCommon","backgroundCommon"],function(e,i,t,r,o,s){function a(e){return e.isExperimentOpen("sv_mobileBG")?e.isMobileView?"viewport"!==e.compData.mediaSizing:!e.fixedSiteBackground:e.isMobileView||!e.fixedSiteBackground}function n(i,t){var r=e.get(i,"scrollType"),o=e.get(i,["mediaRef","type"]);return(!("Image"===o||"WixVideo"===o)||a(t)||t.isAndroidOldBrowser)&&(r="scroll"),r}function p(i,t){var r="absolute";return"WixVideo"!==e.get(i,["mediaRef","type"])&&"fixed"!==t&&"parallax"!==t||(r="fixed"),r}function c(e,i,t){var o=n(i,e),s=p(i,o),a={top:0,height:"100%",width:"100%",backgroundColor:r.colorParser.getColor(e.colorsMap,i.color),display:t?"none":"",position:s};return e.isMobileView&&"fixed"===s&&(a.willChange="transform"),a}function l(e){var i="100%";return"parallax"===e&&(i="120%"),i}function u(e){var i=0;return"parallax"===e&&(i=0),i}function d(e,i){var t=i.mediaRef,r=n(i,e),o={position:"absolute",top:u(r),height:l(r),width:"100%",opacity:t&&t.opacity};return e.isMobileView&&"fixed"===r&&(o.willChange="transform"),o}function g(){return[{action:"bgScrub",name:"SiteBackgroundParallax",duration:1,delay:0}]}function h(i,t){var r=i.mediaRef||{},o=t.mediaRef||{},s=!i.mediaRef&&!t.mediaRef,a=s||r.type===o.type,n="WixVideo"===r.type&&a,p=["mediaRef","imageOverlay"],c=["type","alignType","fittingType","scrollType","colorOverlay","colorOverlayOpacity","color","videoId","uri","opacity"];return n?c=e.without(c,"color"):s&&(c=["color"]),a&&m(i,t,p,c)}function m(i,t,r,o){var s=e.every(o,function(e){return(i&&i[e])===(t&&t[e])});return s=s&&e.every(r,function(e){return!i||m(i[e],t[e],r,o)})}function v(e,i){var t=i.colorOverlay?r.colorParser.getColor(e.colorsMap,i.colorOverlay,i.colorOverlayOpacity):null;return{position:"absolute",top:0,width:"100%",height:"100%",backgroundImage:y(e,i.imageOverlay),backgroundColor:t}}function y(e,i){return i?"url("+r.urlUtils.joinURL(e.staticMediaUrl,i.uri)+")":null}var f=r.mediaConsts;return{displayName:"SiteBackground",mixins:[o.mediaLogicMixins.fill,t.compMixins.skinBasedComp,t.compMixins.animationsMixin,s.mixins.backgroundDetectionMixin],propTypes:e.defaults({id:i.Types.Component.id,compData:i.Types.Media.SiteBackground.data,actionsAspect:i.Types.SiteAspects.actionsAspect.isRequired,currentUrlPageId:i.Types.Component.currentUrlPageId,isMobileView:i.Types.isMobileView.isRequired,isTouchDevice:i.Types.Device.isTouchDevice,isAndroidOldBrowser:i.Types.Browser.isAndroidOldBrowser,colorsMap:i.Types.Theme.colorsMap,staticMediaUrl:i.Types.ServiceTopology.staticMediaUrl,componentViewMode:i.Types.RenderFlags.componentViewMode.isRequired,fixedSiteBackground:i.Types.BrowserFlags.fixedSiteBackground.isRequired,mediaQuality:i.Types.Media.SiteBackground.mediaQuality,isExperimentOpen:i.Types.isExperimentOpen},i.santaTypesUtils.getSantaTypesByDefinition(s.components.html5Video)),statics:{useSantaTypes:!0,behaviors:o.mediaBehaviors.fill},previousScroll:null,getInitialState:function(){return this.size={},{resetAttachment:!1,hidePrevious:!1}},callForBackgroundChange:function(i){var t={onComplete:function(){this.isPageChanged()&&(e.result(this.refs,["previousVideo","kill"]),this.setState({previousPageBackground:null,resetAttachment:!1,hidePrevious:!0}))}.bind(this)};this.props.actionsAspect.registerNextBGPageTransition(this,"previous","current",t),this.setState({previousPageBackground:i,resetAttachment:!0,hidePrevious:!1,currentVisiblePageId:null})},componentWillReceiveProps:function(i){if(this.isPageChanged()){var t=this.props.compData.background;h(i.compData.background,t)?(e.result(this.refs,["previousVideo","kill"]),this.setState({previousPageBackground:null,currentVisiblePageId:this.state.currentVisiblePageId||this.props.compData.background.id})):this.callForBackgroundChange(t)}},handleParallaxBehavior:function(e){var i=n(e,this.props);("parallax"===this.previousScroll||"parallax"===i)&&(this.previousScroll=i,"parallax"===i?this.props.actionsAspect.registerBehaviors("currentImage","siteBackground",g()):this.props.actionsAspect.unRegisterBehaviors("currentImage",g()))},getClasses:function(){return""},isPageChanged:function(){return this.props.compData.background.id!==e.get(this.state,["previousPageBackground","id"])},createVideoComponent:function(i,t){var r={comp:"wysiwyg.viewer.components.background.html5Video",skin:"skins.viewer.bgVideo.html5VideoSkin",style:"bgVideo"},o=i.mediaRef,s="current"===t;return"WixVideo"!==e.get(o,"type")?(s&&this.setMediaAPI(null),null):this.createChildComponent(o,r.comp,{skin:r.skin,styleId:r.style},{id:this.props.id+t+"Video",notifyMediaState:this.onMediaChange,setMediaAPI:s?this.setMediaAPI:e.noop,mediaQuality:this.props.mediaQuality,className:"siteBackground"+t+"Video",compProp:e.pick(o,f.playback.SUPPORTED_MEDIA_ATTRIBUTES)})},getSkinProperties:function(){var i=this.state.currentVisiblePageId||this.props.compData.background.id,t=e.get(this.state.previousPageBackground,"id","noPrev");t=t===i?"noPrev":t;var r,o,s,a,p=null,l=!this.props.isTouchDevice,u=this.props.id,g=this.props.compData.background;a={id:u+"_currentImage_"+i,style:d(this.props,g),"data-type":f.balataConsts.BG_IMAGE},l&&((o=this.createVideoComponent(g,"current"))||this.setMediaAPI(null)),this.state.previousPageBackground&&(p=this.state.previousPageBackground,s={id:u+"_previousImage_"+t,style:p?d(this.props,p):{}},l&&(r=this.createVideoComponent(p,"previous"))),this.handleParallaxBehavior(g);var h=c(this.props,g,!1);return{"":{id:u,className:this.getClasses()},current:{key:i+n(g,this.props)+this.props.componentViewMode,id:u+"_current_"+i,style:h,"data-position":h.position},currentImage:a,currentVideo:o,currentOverlay:{id:u+"_currentOverlay_"+i,style:v(this.props,g)},previous:{key:t+n(p,this.props)+this.props.componentViewMode,id:u+"_previous_"+t,style:p?c(this.props,p,this.state.hidePrevious):{}},previousImage:s,previousVideo:r,previousOverlay:{id:u+"_previousOverlay_"+t,style:p?v(this.props,p):{}}}}}});
//# sourceMappingURL=siteBackground.min.js.map